(function(){"use strict";function a(){}function b(a,b){for(var c=a.length;c--;)if(a[c].listener===b)return c;return-1}function c(a){return function(){return this[a].apply(this,arguments)}}var d=a.prototype;d.getListeners=function(a){var b,c,d=this._getEvents();if("object"==typeof a){b={};for(c in d)d.hasOwnProperty(c)&&a.test(c)&&(b[c]=d[c])}else b=d[a]||(d[a]=[]);return b},d.flattenListeners=function(a){var b,c=[];for(b=0;b<a.length;b+=1)c.push(a[b].listener);return c},d.getListenersAsObject=function(a){var b,c=this.getListeners(a);return c instanceof Array&&(b={},b[a]=c),b||c},d.addListener=function(a,c){var d,e=this.getListenersAsObject(a),f="object"==typeof c;for(d in e)e.hasOwnProperty(d)&&-1===b(e[d],c)&&e[d].push(f?c:{listener:c,once:!1});return this},d.on=c("addListener"),d.addOnceListener=function(a,b){return this.addListener(a,{listener:b,once:!0})},d.once=c("addOnceListener"),d.defineEvent=function(a){return this.getListeners(a),this},d.defineEvents=function(a){for(var b=0;b<a.length;b+=1)this.defineEvent(a[b]);return this},d.removeListener=function(a,c){var d,e,f=this.getListenersAsObject(a);for(e in f)f.hasOwnProperty(e)&&(d=b(f[e],c),-1!==d&&f[e].splice(d,1));return this},d.off=c("removeListener"),d.addListeners=function(a,b){return this.manipulateListeners(!1,a,b)},d.removeListeners=function(a,b){return this.manipulateListeners(!0,a,b)},d.manipulateListeners=function(a,b,c){var d,e,f=a?this.removeListener:this.addListener,g=a?this.removeListeners:this.addListeners;if("object"!=typeof b||b instanceof RegExp)for(d=c.length;d--;)f.call(this,b,c[d]);else for(d in b)b.hasOwnProperty(d)&&(e=b[d])&&("function"==typeof e?f.call(this,d,e):g.call(this,d,e));return this},d.removeEvent=function(a){var b,c=typeof a,d=this._getEvents();if("string"===c)delete d[a];else if("object"===c)for(b in d)d.hasOwnProperty(b)&&a.test(b)&&delete d[b];else delete this._events;return this},d.removeAllListeners=c("removeEvent"),d.emitEvent=function(a,b){var c,d,e,f,g=this.getListenersAsObject(a);for(e in g)if(g.hasOwnProperty(e))for(d=g[e].length;d--;)c=g[e][d],c.once===!0&&this.removeListener(a,c.listener),f=c.listener.apply(this,b||[]),f===this._getOnceReturnValue()&&this.removeListener(a,c.listener);return this},d.trigger=c("emitEvent"),d.emit=function(a){var b=Array.prototype.slice.call(arguments,1);return this.emitEvent(a,b)},d.setOnceReturnValue=function(a){return this._onceReturnValue=a,this},d._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},d._getEvents=function(){return this._events||(this._events={})},"function"==typeof define&&define.amd?define(function(){return a}):"object"==typeof module&&module.exports?module.exports=a:this.EventEmitter=a}).call(this),function(){"use strict";var a=function(a){if("string"!=typeof a)return new TypeError("Not a string");var b;try{b=JSON.parse(a)}catch(c){b=c}return b},b=function(a){if("object"!=typeof a)return new TypeError("Not an object");try{a=JSON.stringify(a)}catch(b){return b}return a},c={parse:a,serialize:b};"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=c:window.conducto=c}(),function(){"use strict";var a,b,c;if("undefined"!=typeof window)a=window.EventEmitter,b=window.conducto.parse,c=window.conducto.serialize;else{var d=require("./utils");b=d.parse,c=d.serialize,a=require("events").EventEmitter}var e=function(){this.transport=null,this.notificationHandlers={},this.requestHandlers={},this.responseHandlers={},this.events=new a,this._emit=this.events.emit.bind(this.events),this._on=this.events.on.bind(this.events),this.lastId=0,this.stack=[],this.localEvents=["close","send","error","open","message"]},f={isLocalEvent:function(a){return-1!==this.localEvents.indexOf(a)?!0:!1},onError:function(a){a.data&&(a=a.data),this.emit("error",a)},onClose:function(){this.emit("close")},close:function(){this.transport.close()},on:function(a,b){return this.isLocalEvent(a)?this._on(a,b):(this.addEventHandler(a,b),void 0)},emit:function(a,b,c){if(this.isLocalEvent(a))return this._emit(a,arguments[1]);var b,c;arguments[1]&&("object"==typeof arguments[1]?b=arguments[1]:"function"==typeof arguments[1]&&(c=arguments[1])),arguments[2]&&"function"==typeof arguments[2]&&(c=arguments[2]),c?this.request(a,b,c):this.notify(a,b)},listen:function(a,b){this.addNotificationHandler(a,b),this.addRequestHandler(a,b)},onMessage:function(a){a.data&&(a=a.data);var a=b(a);if(!(a instanceof Error))if(Array.isArray(a))for(var c=0,d=a.length;d>c;c++)this.onStanza(a[c]);else this.onStanza(a)},onStanza:function(a){this.emit("message",a),a.method?this.server?this.server.onMessage(a,this):this.test(this,a):this.server||this.onResponse(a)},notify:function(a,b){var c={method:a};void 0!==b&&(c.payload=b),this.sendStanza(c)},send:function(a){this.sendStanza(a)},sendStanza:function(a){var b=c(a);return b instanceof Error?b:(this.transport.send(b),this.emit("send",a),void 0)},onRequest:function(a){return},onResponse:function(a){var b=this.getResponseHandler(a.id);b&&(b(a.error,a.result),this.deleteResponseHandler(a.id))},onNotification:function(a){var b=this.getNotificationHandler(a.method);return b?b(a.payload):void 0},sendRequest:function(a,b){"undefined"==typeof a.id&&(a.id=(this.lastId++).toString()),b&&this.addResponseHandler(a.id,b),this.sendStanza(a)},request:function(a,b,c){var c,d={method:a};"function"==typeof arguments[1]?c=arguments[1]:(d.payload=arguments[1],c=arguments[2]),this.sendRequest(d,c)},respond:function(a,b,c){var d={id:a.id};null!==b&&void 0!==b?d.error=b:"undefined"!=typeof c&&(d.result=c),this.sendStanza(d)},addResponseHandler:function(a,b){this.responseHandlers[a]=b.bind(this)},getResponseHandler:function(a){return this.responseHandlers[a]},deleteResponseHandler:function(a){delete this.responseHandlers[a]},addRequestHandler:function(a,b){this.requestHandlers[a]=b},getRequestHandler:function(a){return this.requestHandlers[a]},deleteRequestHandler:function(a){delete this.requestHandlers[a]},addNotificationHandler:function(a,b){this.notificationHandlers[a]=b.bind(this)},getNotificationHandler:function(a){this.notificationHandlers[a]},deleteNotificationHandler:function(a){delete this.notificationHandlers[a]},use:function(a){this.stack.push(a)},test:function(a,b){var c,d=this.stack,e=0,f={client:a,method:b.method,payload:b.payload};if(b.id){f.id=b.id;var g=!1;c=function(c,d){if(g)throw new Error("A response to request "+b.id+" has already been sent.");a.respond(b,c,d),g=!0};var h=function(){var i=d[e++];return i?(i(f,c,h),void 0):(g||a.respond(b,"Method not found"),void 0)}}else var h=function(){var a=d[e++];a&&a(f,c,h)};h()},addEventHandler:function(a,b){return this.use(function(c,d,e){return c.method!==a?e():(b(c.payload,d,e),void 0)}),void 0;var a,b}};for(var g in f)e.prototype[g]=f[g];"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=e:window.conducto.Connection=e}(),function(){"use strict";var a,b;"undefined"!=typeof window?(a=window.conducto.Connection,b=window.WebSocket):(a=require("./Connection"),b=require("ws"));var c=function(){this.transport=null,this.url=null};c.prototype=new a;var d={onOpen:function(){this.emit("open")},open:function(a){this.url=a;var c=new b(a);c.addEventListener("open",this.onOpen.bind(this)),c.addEventListener("close",this.onClose.bind(this)),c.addEventListener("error",this.onError.bind(this)),c.addEventListener("message",this.onMessage.bind(this)),c=c}};for(var e in d)c.prototype[e]=d[e];"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=c:window.conducto.Client=c}(),function(){"use strict";var a;a="undefined"!=typeof window?window.conducto:require("../node_modules/conducto");var b=function(b){return new a.Client(b)};"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=b:window.Y=b}();